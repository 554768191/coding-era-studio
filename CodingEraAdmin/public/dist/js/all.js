"use strict";var ApplicationConfiguration=function(){var e="codingEra",t=["ngResource","ngAnimate","ui.router","ui.bootstrap","ui.utils","pascalprecht.translate","ui.grid","ui.grid.pagination","ui.grid.selection","ngFileUpload"],n=function(t,n){angular.module(t,n||[]),angular.module(e).requires.push(t)};return{applicationModuleName:e,applicationModuleVendorDependencies:t,registerModule:n}}(),ceApp=angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies);ceApp.run(["$rootScope","$translate","$templateCache",function(e,t,n){e.$on("$translatePartialLoaderStructureChanged",function(){t.refresh()}),n.put("cePaginationTemplate","modules/core/views/templates/core.pagination.template.html")}]).config(["$locationProvider","$httpProvider","$translateProvider","$translatePartialLoaderProvider",function(e,t,n,o){e.hashPrefix("!"),n.useLoader("$translatePartialLoader",{urlTemplate:"modules/{part}/i18n/{part}-{lang}.json"});var a=["post","put"];angular.forEach(a,function(e){t.defaults.headers[e]["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8"});var r=function(e){var t,n,o,a,i,s,l,c="";for(t in e)if(n=e[t],n instanceof Array)for(l=0;l<n.length;++l)i=n[l],o=t+"["+l+"]",s={},s[o]=i,c+=r(s)+"&";else if(n instanceof Object)for(a in n)i=n[a],o=t+"["+a+"]",s={},s[o]=i,c+=r(s)+"&";else 0!==n&&null!==n&&(c+=encodeURIComponent(t)+"="+encodeURIComponent(n)+"&");return c.length?c.substr(0,c.length-1):c};t.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?r(e):e}],o.addPart("core"),n.preferredLanguage("zh-cn"),n.useSanitizeValueStrategy("escaped")}]),angular.module("ui.grid.i18n").config(["i18nConstants",function(e){e.DEFAULT_LANG="zh-cn"}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),"#"===window.location.href[window.location.href.length-1]&&window.location.href.length-window.location.origin.length===2&&(window.location.href=window.location.origin+"/#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ceApp.constant("ceConfig",{apiUrl:"http://localhost:8080/api",showDisplayPage:5}),ApplicationConfiguration.registerModule("case"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("demo"),ApplicationConfiguration.registerModule("dynamic"),ApplicationConfiguration.registerModule("todo"),ApplicationConfiguration.registerModule("users"),angular.module("case").value("path","modules/case").run(["Menus",function(e){var t=e.genParentMenus({name:"作品",icon:"th-large"});t.setOrder(-1);var n=e.genNodeMenus({name:"作品列表",subTitle:"管理作品列表",icon:"th-list",route:"caseManage"});t.addNodeMenus(n);var o=e.genNodeMenus({name:"标签管理",subTitle:"管理标签列表",icon:"tag",route:"tagList"});t.addNodeMenus(o),e.addMenus(t.getMenus())}]).config(["$stateProvider","$translatePartialLoaderProvider",function(e,t){t.addPart("case"),e.state("caseManage",{url:"/case",templateUrl:"modules/case/views/case.manage.view.html",controller:"caseManageCtrl"}).state("caseManage.list",{url:"/list?:status",templateUrl:"modules/case/views/case.list.view.html",controller:"caseListCtrl"}).state("caseManage.publish",{url:"/publish?:caseId",templateUrl:"modules/case/views/case.publish.view.html",controller:"casePublishCtrl"}).state("tagEdit",{url:"/tag/edit",templateUrl:"modules/case/views/case.tag.edit.view.html",controller:"tagEditCtrl"}).state("tagList",{url:"/tag/list",templateUrl:"modules/case/views/case.tag.list.view.html",controller:"tagListCtrl"})}]),angular.module("case").controller("caseListCtrl",["$scope","$log","$translate","$state","$stateParams","CaseService","ceUtil",function(e,t,n,o,a,r,i){e.caseData={};var s={page:0,size:10,sort:null,status:a.status};e.onSearch=function(){r.getCases(s).success(function(t){e.caseData=t.data})},e.onSearch(),e.onEditClick=function(e){o.go("caseManage.publish",{caseId:e})},e.onDeleteClick=function(t){i.confirmMessage("确认删除?").success(function(){r.deleteCase({id:t}).success(function(){i.toast("删除成功"),e.onSearch()})})},e.previousPage=function(){s.page-=1,e.onSearch()},e.nextPage=function(){s.page+=1,e.onSearch()}}]),angular.module("case").controller("caseManageCtrl",["$scope","$log","$state","ceUtil",function(e,t,n){n.is("caseManage")&&n.go("caseManage.list",{status:"PUBLISHED"})}]),angular.module("case").controller("casePublishCtrl",["$scope","$log","$state","$stateParams","CaseService","ceUtil",function(e,t,n,o,a,r){e["case"]={},angular.isUndefined(o.caseId)||(console.log(o.caseId),a.getCaseById(o.caseId).success(function(t){e["case"]=t.data})),e.$watch("case.content",function(t,n){t&&(console.log(t),console.log(window.marked(t)),e["case"].maker=window.marked(t))}),e.onPublishClick=function(t){e["case"].status=t,a.saveCase(e["case"]).success(function(e){r.toast("发布成功"),n.go("caseManage.list",{status:t})})}}]),angular.module("case").controller("tagEditCtrl",["$scope","$uibModalInstance","$log","TagService","ceUtil","tag",function(e,t,n,o,a,r){e.tag=r||{},e.ok=function(){o.save(e.tag).success(function(e){a.toast("保存成功"),t.close()})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("case").controller("tagListCtrl",["$scope","$log","$translate","$uibModal","path","TagService","ceUtil",function(e,t,n,o,a,r,i){e.selectedData=null,e.isSelected=!1,e.onEditClick=function(t){var n=t;if(!n){if(e.isSelected===!1)return void i.toast("请选中一行数据");n=e.selectedData}var a=o.open({animation:!0,templateUrl:"modules/case/views/case.tag.edit.view.html",controller:"tagEditCtrl",resolve:{tag:function(){return n}}});a.result.then(function(){e.onSearch()})},e.onDeletedClick=function(t){var n=t;if(!n){if(e.isSelected===!1)return void i.toast("请选中一行数据");n=e.selectedData}r.deleteTag(n).success(function(){e.onSearch()})},e.onCreateClick=function(){var t=o.open({animation:!0,templateUrl:"modules/case/views/case.tag.edit.view.html",controller:"tagEditCtrl",resolve:{tag:function(){return{}}}});t.result.then(function(){e.onSearch()})},e.tagData={},e.searchOptions={keyWord:"",page:0,size:10,sort:null},e.gridOptions={enableFullRowSelection:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,selectionRowHeaderWidth:35,multiSelect:!1,gridMenuTitleFilter:n,data:"tagData.data.content",paginationPageSizes:[10,20,50],paginationPageSize:10,useExternalPagination:!0,rowHeight:40,animate:!1,columnDefs:[{name:"name",displayName:"标签名称",allowCellFocus:!0},{name:"type",displayName:"类型"},{name:"hot",displayName:"热度"},{name:"ShowScope",displayName:"Actions",cellTemplate:'<div class="btn-group-sm"><button class="btn btn-info" ng-click="grid.appScope.onEditClick(row.entity)">编辑</button><button class="btn btn-danger" ng-click="grid.appScope.onDeletedClick(row.entity)">删除</button></div>'}],paginationTemplate:i.getPaginationTemplate(),onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.isSelected=t.isSelected,e.selectedData=t.entity}),t.pagination.on.paginationChanged(e,function(t,n){e.searchOptions.page=t-1,e.searchOptions.size=n,e.onSearch()})}},e.onSearch=function(){r.getTags(e.searchOptions).success(function(t){e.tagData=t,e.gridOptions.totalItems=t.data.totalElements})},e.onSearch()}]),angular.module("case").factory("CaseService",["$log","ceAjax",function(e,t){var n={};return n.getCaseById=function(e){return t.get({url:"/case/"+e})},n.saveCase=function(e){return t.post({url:"/case",data:e})},n.getCases=function(e){return t.get({url:"/case/list",data:e})},n.deleteCase=function(e){return t["delete"]({url:"/case",data:e})},n}]),angular.module("case").factory("TagService",["$log","ceAjax",function(e,t){var n={};return n.getTags=function(e){return t.get({url:"/tag",data:e})},n.save=function(e){return t.post({url:"/tag",data:e})},n.deleteTag=function(e){return t["delete"]({url:"/tag",data:e})},n}]),angular.module("core").run(["ContentHead",function(e){e.setTitle("Dashboard")}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function(e,t,n){}]),angular.module("core").directive("ceUiButterbar",["$rootScope","$anchorScroll",function(e,t){return{restrict:"AC",template:'<span class="bar"></span>',link:function(e,n,o){n.addClass("butterbar hide"),e.$on("$stateChangeStart",function(e){t(),n.removeClass("hide").addClass("active")}),e.$on("$stateChangeSuccess",function(e,t,o,a){e.targetScope.$watch("$viewContentLoaded",function(){n.addClass("hide").removeClass("active")})})}}}]),angular.module("core").directive("ceH5Upload",["$rootScope","ceUtil",function(e,t){return{restrict:"E",templateUrl:"modules/core/views/templates/core.ce.h5.upload.template.html",transclude:!0,scope:!0,require:"ngModel",link:function(e,n,o,a){e.showImage=!1;var r=angular.element(document.querySelector(".ce-h5-upload")),i=r[0],s=function(n){if(n.length>1)return void t.toast("只能上传一张图片");var o=n[0];console.log(o);var i=o.name;t.loading();var s=new AV.File(i,o);s.save().then(function(n){t.loading(),console.log(n.url()),e.showImage=!0,e.$apply(),r.find("img").attr("src",n.url()),a.$setViewValue(n.url())},function(e){t.loading(),console.log(e)})};document.addEventListener("dragenter",function(e){i.style.borderColor="gray"},!1),document.addEventListener("dragleave",function(e){i.style.borderColor="silver"},!1),i.addEventListener("dragenter",function(e){i.style.backgroundColor="white"},!1),i.addEventListener("dragleave",function(e){i.style.backgroundColor="transparent"},!1),i.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),i.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),i.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),i.style.backgroundColor="transparent",s(e.dataTransfer.files)},!1)}}}]),angular.module("core").directive("ceCode",function(){return{restrict:"E",terminal:!0,replace:!0,compile:function(e){var t=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},n=/[&<>"'\/]/g;return(""+e).replace(n,function(e){return t[e]})},n=t(e.html()).trim(),o='<pre class="ce-code">'+window.prettyPrintOne(n,"HTML",!0)+"</pre>";e.html(o)}}}),angular.module("core").directive("ceContentView",["$window",function(e){var t={restrict:"C",link:function(t,n){t.onResize=function(){var t=angular.element(document.querySelector(".ce-head")).height(),o=e.innerHeight;n.css({height:o-t+"px"})},t.onResize(),angular.element(e).bind("resize",function(){t.onResize()}),angular.element(e).bind("scroll",function(){t.onResize()})}};return t}]),angular.module("core").directive("ceContentHead",["$window","ContentHead","Authentication",function(e,t,n){var o={restrict:"EA",templateUrl:"modules/core/views/templates/core.content.head.template.html",scope:!0,controller:function(e,t){e.authentication=n,e.title=t.getTitle(),e.subTitle=t.getSubTitle()},link:function(e,n,o){e.$on("$stateChangeSuccess",function(e,n,o,a){e.targetScope.$watch("$viewContentLoaded",function(){var e=n.name,o=e.split(".");o.length>1&&(e=o[0]),t.autoRefreshTitle(e)})})}};return o}]),angular.module("core").directive("ceLoadingBar",["$rootScope",function(e){return{restrict:"EA",templateUrl:"modules/core/views/templates/core.loadingbar.template.html",link:function(t,n,o){e.$on("startLoading",function(){t.show=!0,t.$apply()}),e.$on("stopLoading",function(){t.show=!1,t.$apply()})}}}]),angular.module("core").config(function(){String.prototype.startWith=function(e,t){var n="undefined"!=typeof t&&t?this.trim():this;return"string"==typeof e&&n.length>=e.length&&n.substr(0,e.length)===e},String.prototype.endWith=function(e,t){var n="undefined"!=typeof t&&t?this.trim():this;return"string"==typeof e&&n.length>=e.length&&n.substr(n.length-e.length)===e}}).constant("ceMarkdownConfig",{toolbar:[{group:[{action:"bold",icon:"glyphicon-bold",tip:"加粗(Ctrl+B)"},{action:"italic",icon:"glyphicon-italic",tip:"斜体(Ctrl+I)"},{action:"header",icon:"glyphicon-header",tip:"标题(Ctrl+H)"}]},{group:[{action:"ul",icon:"glyphicon-align-justify",tip:"无序列表(Ctrl+U)"},{action:"ol",icon:"glyphicon-list",tip:"有序列表(Ctrl+O)"},{action:"code",icon:"glyphicon-console",tip:"代码(Ctrl+K)"},{action:"quote",icon:"glyphicon-menu-right",tip:"引用(Ctrl+Q)"}]},{group:[{action:"link",icon:"glyphicon-link",tip:"连接(Ctrl+L)"},{action:"img",icon:"glyphicon-picture",tip:"图片(Ctrl+G)"}]},{group:[{action:"undo",icon:"glyphicon-repeat",tip:"撤销"},{action:"redo",icon:"glyphicon-refresh",tip:"重做"},{action:"preview",icon:"glyphicon-eye-open",tip:"浏览"}]}]}).factory("markdownActions",[function(){function e(e,t,o){var a=e.getSelections(),r=[],i=n[t].prefix,s=n[t].postfix;a.forEach(function(e){console.log("text",e),e.length>=i.length+s.length&&e.startWith(i,o)&&e.endWith(s)?r.push(e.substr(i.length,e.length-i.length-s.length)):r.push(i+e+s)}),e.replaceSelections(r,"around")}function t(e,t){var o=e.listSelections();o.forEach(function(t){var n=t.anchor.line,o=t.head.line,a=o>n?n:o,r=n>o?n:o;e.addSelection({line:a,ch:0},{line:r})});var a=n[t].prefix,r=[];o=e.getSelections(),o.forEach(function(e){r.push(e.split("\n").map(function(e){if(e.startWith(a,!0)){var t=e.indexOf(a),n=e.substr(0,t),o=e.substr(t+a.length);return n+o}return a+e}).join("\n"))}),e.replaceSelections(r,"around")}var n={bold:{prefix:"**",postfix:"**"},italic:{prefix:"_",postfix:"_"},code:{prefix:"```\n",postfix:"\n```"},link:{prefix:"[",postfix:"](src)"},img:{prefix:"![",postfix:"](src)"},header:{prefix:"### ",postfix:""},quote:{prefix:"> ",postfix:""},ul:{prefix:"- ",postfix:""}};return{bold:function(t){e(t,"bold")},italic:function(t){e(t,"italic")},code:function(t){e(t,"code")},link:function(t){e(t,"link")},img:function(t){e(t,"img")},header:function(e){t(e,"header")},quote:function(e){t(e,"quote")},ul:function(e){t(e,"ul")},ol:function(e){var t=e.listSelections();t.forEach(function(t){var n=t.anchor.line,o=t.head.line,a=o>n?n:o,r=n>o?n:o;e.addSelection({line:a,ch:0},{line:r})});var n=[];t=e.getSelections(),t.forEach(function(e){/^\s*\d+\.\s/m.test(e)?n.push(e.replace(/^\s*\d+\.\s/gm,"")):n.push(e.split("\n").map(function(e,t){return t+1+". "+e}).join("\n"))}),e.replaceSelections(n,"around")},undo:function(e){e.undo()},redo:function(e){e.redo()}}}]).filter("markdown",["$sce",function(e){var t=function(e){return e.setOptions({renderer:new e.Renderer,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),e}(window.marked);return function(n){return n&&"string"==typeof n?e.trustAsHtml(t(n)):""}}]).directive("ceMarkdown",["markdownActions","ceMarkdownConfig",function(e,t){return{restrict:"E",replace:!0,require:"ngModel",template:['<div class="ce-markdown-container">','<div class="markdown-toolbar">','<div class="btn-group btn-group-sm" role="group" ng-repeat="item in toolbar" >','<button ng-repeat="toolbtn in item.group" type="button" class="btn btn-default " ng-click="callAction(toolbtn.action)" title="{{toolbtn.tip}}"><span class="glyphicon {{toolbtn.icon}}" aria-hidden="true"></span></button>',"</div>","</div>",'<textarea class="ce-textarea"   ng-show="!preview" ></textarea class>','<div class="ce-preview" ng-bind-html="text | markdown" ng-show="preview"></div>',"</div>"].join(""),compile:function(n,o){if(angular.isUndefined(window.CodeMirror))throw new Error("Require CodeMirror!");var a="default",r=n.find("textarea"),i=new window.CodeMirror(function(e){angular.forEach(r.prop("attributes"),function(t){"class"===t.name?e.className+=" "+t.textContent:e.setAttribute(t.name,t.textContent)}),r.replaceWith(e)},{mode:"gfm",lineWrapping:!0,theme:a});return function(n,o,a,r){n.toolbar=t.toolbar,r.$render=function(){n.text=r.$viewValue||"",i.setValue(n.text)};var s=function(e){n.text=e.getValue(),r.$setViewValue(e.getValue())};i.on("change",s),n.callAction=function(t){if(t){if(e[t])e[t](i);else if("preview"===t)n.preview=!n.preview;else if("fullscreen"===t){var a=o[0],r=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen;r&&r.call(o)}i.focus()}}}}}}]),angular.module("core").directive("ceMenu",["$window","$state","Menus","Authentication",function(e,t,n,o){var a={restrict:"EA",templateUrl:"modules/core/views/templates/core.menu.template.html",replace:!0,controller:function(e,t,n,o){e.authentication=o,e.items=n.getMenus(),e.onShowNode=function(e){e.show=!e.show}},link:function(t,o){var a=angular.element(document.querySelector(".ce-head")).height();t.onResize=function(){var t=angular.element(document.querySelector(".ce-content")).height(),n=e.innerHeight;t>n?o.css({height:t+"px"}):o.css({height:n-a+"px"})},t.onResize(),angular.element(e).bind("resize",function(){t.onResize()}),angular.element(e).bind("scroll",function(){t.onResize()}),t.$on("$stateChangeSuccess",function(e,t,o,a){e.targetScope.$watch("$viewContentLoaded",function(){var e=t.name,o=e.split(".");o.length>1&&(e=o[0]),n.expandMenuByRoute(e)})})}};return a}]),angular.module("core").directive("ceGridPager",["uiGridPaginationService","uiGridConstants","gridUtil","i18nService","ceConfig",function(e,t,n,o,a){return{priority:-200,scope:!0,require:"^uiGrid",link:function(r,i,s,l){var c=".ui-grid-pager-control-input";r.aria=o.getSafeText("pagination.aria"),r.paginationApi=l.grid.api.pagination,r.sizesLabel=o.getSafeText("pagination.sizes"),r.totalItemsLabel=o.getSafeText("pagination.totalItems"),r.paginationOf=o.getSafeText("pagination.of"),r.paginationThrough=o.getSafeText("pagination.through");var u=l.grid.options;l.grid.renderContainers.body.registerViewportAdjuster(function(e){return e.height=e.height-n.elementHeight(i),e});var d=l.grid.registerDataChangeCallback(function(e){e.options.useExternalPagination||(e.options.totalItems=e.rows.length)},[t.dataChange.ROW]);r.$on("$destroy",d);var p=function(){r.showingLow=(u.paginationCurrentPage-1)*u.paginationPageSize+1,r.showingHigh=Math.min(u.paginationCurrentPage*u.paginationPageSize,u.totalItems)},g=r.$watch("grid.options.totalItems + grid.options.paginationPageSize",p),f=r.$watch("grid.options.paginationCurrentPage + grid.options.paginationPageSize",function(t,n){if(t!==n&&void 0!==n){if(!angular.isNumber(u.paginationCurrentPage)||u.paginationCurrentPage<1)return void(u.paginationCurrentPage=1);if(u.totalItems>0&&u.paginationCurrentPage>r.paginationApi.getTotalPages())return void(u.paginationCurrentPage=r.paginationApi.getTotalPages());p(),e.onPaginationChanged(r.grid,u.paginationCurrentPage,u.paginationPageSize)}});r.$on("$destroy",function(){g(),f()}),r.cantPageForward=function(){return u.totalItems>0?u.paginationCurrentPage>=r.paginationApi.getTotalPages():u.data.length<1},r.cantPageToLast=function(){return u.totalItems>0?r.cantPageForward():!0},r.cantPageBackward=function(){return u.paginationCurrentPage<=1};var m=function(e){e&&n.focus.bySelector(i,c)};r.pageFirstPageClick=function(){r.paginationApi.seek(1),m(r.cantPageBackward())},r.pagePreviousPageClick=function(){r.paginationApi.previousPage(),m(r.cantPageBackward())},r.pageNextPageClick=function(){r.paginationApi.nextPage(),m(r.cantPageForward())},r.pageLastPageClick=function(){r.paginationApi.seek(r.paginationApi.getTotalPages()),m(r.cantPageToLast())},r.getMinPage=function(){var e=r.paginationApi.getPage(),t=a.showDisplayPage%2===0?a.showDisplayPage/2:(a.showDisplayPage+1)/2;return t>e?1:e>=r.paginationApi.getTotalPages()-a.showDisplayPage+(t-1)?r.paginationApi.getTotalPages()-a.showDisplayPage:e-(t-1)},r.getMaxPage=function(){var e=r.paginationApi.getPage(),t=a.showDisplayPage%2===0?a.showDisplayPage/2:(a.showDisplayPage+1)/2;return t>e?a.showDisplayPage:e+(t-1)}}}}]),angular.module("core").directive("ceToast",["$rootScope","$timeout","$uibPosition","ceUtil",function(e,t,n,o){return{restrict:"EA",templateUrl:"modules/core/views/templates/core.toast.template.html",replace:!0,scope:{show:"@"},controller:function(e){e.message="",e.style=""},link:function(t,n,o){e.$on("showToast",function(o,a){t.message=a,n.css("opacity","1.0"),t.$apply(),setTimeout(function(){e.$emit("hideToast")},3e3)}),e.$on("hideToast",function(e){t.$apply(function(){n.css("opacity","0.0")})})}}}]),angular.module("core").directive("cePanel",[function(){var e={restrict:"EA",template:'<div class="panel panel-default" ng-transclude></div>',replace:!0,transclude:!0};return e}]).directive("cePanelTitle",function(){return{restrict:"EA",transclude:!0,replace:!0,template:' <div class="panel-heading" ng-transclude></div>'}}).directive("cePanelContent",function(){return{restrict:"EA",transclude:!0,replace:!0,template:' <div class="panel-body" ng-transclude></div>'}}).directive("cePanelFooter",function(){return{restrict:"EA",transclude:!0,replace:!0,template:' <div class="panel-footer" ng-transclude></div>'}}),angular.module("core").filter("numberToArray",function(){return function(e){return new Array(e)}}),angular.module("core").factory("ContentHead",["$log","Menus",function(e,t){var n=[],o=[],a={};return a.autoRefreshTitle=function(e){var a=t.getMenusByRoute(e);a&&(n[0]=a.name,o[0]=a.subTitle)},a.setTitle=function(e){n[0]=e},a.getTitle=function(){return n},a.getSubTitle=function(){return o},a}]),angular.module("core").factory("ceAjax",["$rootScope","$http","Authentication","ceConfig","ceUtil",function(e,t,n,o,a){var r={},i=n.user.accessToken||"none",s=function(e){var t={};return t.successCallback=null,t.success=function(n){return t.successCallback=n,e},t.errorCallback=null,t.error=function(n){return t.errorCallback=n,e},t.completeCallback=null,t.complete=function(n){return t.completeCallback=n,e},t},l=function(e,n){angular.extend(n,{url:o.apiUrl+n.url}),a.loading(),t(n).success(function(t){a.loading(),"success"===t.result?e.successCallback(t):"undefined"!=typeof e.errorCallback?e.errorCallback(t):a.toast(t.message)}).error(function(e){if(a.loading(),console.log("gay yan",e),e&&e.message){e.status;return void a.toast(e.message)}a.toast("token过期,或者网络连接异常")})};return r.get=function(e){var t=this,n=s(t),o={url:e.url,method:"get",params:e.data||{}};return angular.extend(o.params,{access_token:i}),l(n,o),n},r.post=function(e){var t=this,n=s(t);return angular.extend(e,{method:"post"}),angular.extend(e.data,{access_token:i}),l(n,e),n},r["delete"]=function(e){var t=this,n=s(t),o={url:e.url,method:"delete",params:e.data};return angular.extend(o.params,{access_token:i}),l(n,o),n},r}]),angular.module("core").factory("ceInterceptor",["$rootScope","$q","$injector","ceConfig","Authentication",function(e,t,n,o,a,r){var i={responseError:function(e){return t.reject(e)},response:function(t){var n=t.config.url;return t.config.url.indexOf(a.apiUrl)>=0&&e.$emit("stopLoading",n),t},request:function(t){var n=t.url;return angular.isDefined(n)?(n.indexOf(a.apiUrl)>=0&&e.$emit("startLoading",n),t.headers.Authorization=" bearer "+r.user.accessToken,t):void console.log("找不到要请求的URL")},requestError:function(e){return t.reject(e)}};return i}]),angular.module("core").factory("LoadingBar",[function(){var e={};return e.isShow=!1,e.show=function(){e.isShow=!0},e.hide=function(){e.isShow=!1},e}]),angular.module("core").factory("Menus",[function(){var e=[],t={};return this.defaultRoles=["*"],t.shouldRender=function(e){var t=this.roles||"*";if(!e)return this.isPublic||!1;if(~t.indexOf("*"))return!0;var n=t.split(",");for(var o in e.authorities)for(var a in n)if("ROLE_"+n[a]===e.authorities[o].authority)return!0;return!1},t.getMenus=function(){return e},t.addMenus=function(t){e.splice(e.length,0,t)},t.genParentMenus=function(e){e.shouldRender=t.shouldRender;var n=function(n){angular.isUndefined(e.items)&&(e.items=[]),n.menu.shouldRender=t.shouldRender,n.menu.isPublic=null===n.menu.isPublic||"undefined"==typeof n.menu.isPublic?n.menu.isPublic:e.isPublic,e.items.splice(e.items.length,0,n.menu)},o=function(){return e},a=function(t){e.order=t};return{genParentMenus:t.genParentMenus,addNodeMenus:n,getMenus:o,setOrder:a}},t.genNodeMenus=function(e){return{menu:e,genNodeMenus:t.genNodeMenus}},t.getMenusByRoute=function(t){for(var n=0;n<e.length;n++){var o=e[n];if("undefined"!=typeof o.route){if(o.route===t)return o}else if("undefined"!=typeof o.items)for(var a=0;a<o.items.length;a++){var r=o.items[a];if(r.route===t)return r}}return null},t.expandMenuByRoute=function(t){for(var n=0;n<e.length;n++){var o=e[n];if("undefined"!=typeof o.route)o.route===t&&(o.show=!0);else if("undefined"!=typeof o.items)for(var a=0;a<o.items.length;a++){var r=o.items[a];r.route===t&&(o.show=!0)}}},t}]),angular.module("core").factory("TokenHandler",["Authentication",function(e){var t={},n=e.user.accessToken||"none";t.set=function(e){n=e},t.get=function(){return n};var o=function(e,n){e["_"+n]=e[n],e[n]=function(o,a,r){return e["_"+n](angular.extend({},o||{},{access_token:t.get()}),a,r)}};return t.wrapActions=function(e,t){for(var n=e,a=0;a<t.length;a++)o(n,t[a]);return n},t}]),angular.module("core").factory("ceUtil",["$rootScope","$templateCache","$uibModal",function(e,t,n){var o={};return o.toast=function(t){e.$emit("showToast",t)},o.getPaginationTemplate=function(){var n=(e.$new(!0),t.get("cePaginationTemplate"));return n},o.confirmMessage=function(e){var t=this,o={},a=null;o.success=function(e){return a=e,t};n.open({animation:!0,size:"sm",templateUrl:"/modules/core/views/templates/core.confirm.view.html",controller:function(t,n){t.message=e,t.cancel=function(){n.dismiss("cancel")},t.ok=function(){n.close(),a()}}});return o},o.loadingStatus=!1,o.loading=function(){o.loadingStatus=!o.loadingStatus,o.loadingStatus?e.$emit("startLoading"):e.$emit("stopLoading")},o}]),angular.module("demo").controller("demoCtrl",["$scope","$uibModal","$log","$translate","DemoService","ceConfig","path","ceUtil",function(e,t,n,o,a,r,i,s){e.demoData={},e.keyWord="";var l={page:0,size:10,sort:null};e.onSearch=function(){e.demoData=a.query(l,function(t){e.gridOptions.totalItems=t.data.totalElements})},e.onSearch(),e.onDeletedClick=function(){s.toast("测试")},e.onCreateClick=function(){var n=t.open({animation:!0,templateUrl:i+"/views/demo.edit.view.html",controller:"demoEditCtrl",resolve:{}});n.result.then(function(){e.onSearch()})},e.onSearchClick=function(){l.page=0,e.onSearch()},e.$watch("keyWord",function(){l.keyWord=e.keyWord}),e.gridOptions={gridMenuTitleFilter:o,data:"demoData.data.content",paginationPageSizes:[10,20,50],paginationPageSize:10,useExternalPagination:!0,animate:!1,columnDefs:[{name:"name",displayName:"名称"},{name:"remark",displayName:"备注"}],paginationTemplate:s.getPaginationTemplate(),onRegisterApi:function(t){t.pagination.on.paginationChanged(e,function(t,n){l.page=t-1,l.size=n,e.onSearch()})}}}]),angular.module("demo").controller("demoEditCtrl",["$scope","$uibModalInstance","$log","$http","DemoService","ceUtil",function(e,t,n,o,a,r){e.demo={},e.ok=function(){a.save({},e.demo,function(){r.toast("保存成功"),t.close()})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("demo").value("path","modules/demo").run(["Menus",function(e){var t=e.genParentMenus({name:"Super Example",icon:"comment"}),n=e.genNodeMenus({name:"Base Example",subTitle:"这是一个副标题(不配置就不出现)",icon:"ice-lolly-tasted",route:"demo"});t.setOrder(98),t.addNodeMenus(n),e.addMenus(t.getMenus());var o=e.genParentMenus({name:"控件库",icon:"wrench"}),a=e.genNodeMenus({name:"面板",subTitle:"面板的简易封装",route:"widget/panel"}),r=e.genNodeMenus({name:"按钮",subTitle:"基本跟官方一样",route:"widget/button"});o.addNodeMenus(a),o.addNodeMenus(r),e.addMenus(o.getMenus())}]).config(["$stateProvider","$translatePartialLoaderProvider",function(e,t){t.addPart("demo"),e.state("demo",{url:"/demo",templateUrl:"modules/demo/views/demo.view.html",controller:"demoCtrl"}).state("widget/panel",{url:"/widget/panel",templateUrl:"modules/demo/views/demo.widget.panel.view.html"}).state("widget/button",{url:"/widget/button",templateUrl:"modules/demo/views/demo.widget.button.view.html"})}]),angular.module("demo").factory("DemoService",["$resource","$log","ceConfig","TokenHandler",function(e,t,n,o){var a=e(n.apiUrl+"/demo/:demoId",{demoId:"@_id"},{query:{method:"GET",isArray:!1},save:{method:"POST"}});return a=o.wrapActions(a,["query","update","save"])}]),angular.module("dynamic").run(["Menus",function(e){var t=e.genParentMenus({name:"网站管理",icon:"tasks"}),n=e.genNodeMenus({name:"发布动态",icon:"tasks",route:"todo"});t.setOrder(999),t.addNodeMenus(n),e.addMenus(t.getMenus())}]).config(["$stateProvider","$translatePartialLoaderProvider",function(e,t){t.addPart("dynamic"),e.state("dynamic",{url:"/dynamic",templateUrl:"modules/dynamic/views/dynamic.view.html",controller:"dynamicCtrl"})}]),angular.module("dynamic").controller("dynamicCtrl",["$scope","$sce","$uibModal","$log","uibDatepickerPopupConfig","TodoService","TodoCustomService","FileUploadService","Upload",function(e,t,n,o,a,r,i,s,l){window.marked.setOptions({renderer:new window.marked.Renderer,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,highlight:function(e){return window.prettyPrintOne(e,"HTML",!0)}}),e.previewed=!1,e.previewedContent="",e.togglePreview=function(n){return e.previewed=!e.previewed,angular.isUndefined(n)?void(e.previewedContent=""):void(e.previewed===!0&&(e.previewedContent=t.trustAsHtml(window.marked(n))))},e.upload=function(e,t){for(var n in e){var o=e[n];console.log("Jason file",o),s.upload(o,t)}},e.opened=[],a.currentText="今天",a.clearText="清空",a.closeText="确定",e.dynamicPopover={templateUrl:"myPopoverTemplate.html",memberTemplateUrl:"memberTemplate.html"},e.task=i.createTask(),e.addTask=function(t,n){if(n&&n.preventDefault(),e.form.$valid){var o=i.addTask(e.task);o&&(e.task=i.createTask())}},e.cleanTask=function(){e.tasks.length=0},e.taskClass=function(e){return{"task-done":!!e.status}},e.toggleTaskStatus=function(e){i.toggleTaskStatus(e)},e.onEditTask=function(e){console.log("Jason test",e),alert("别紧张,测试而已")},e.$on("tasks.update",function(t){e.$apply(function(){e.tasks=i.tasks})}),e.tasks=i.tasks,e.isCollapsed=!0,e.toggleDetail=function(e,n){console.log("Jason test",e),angular.isUndefined(n.content)||e===!1&&(n.previewedContent=t.trustAsHtml(window.marked(n.content)))}}]),angular.module("dynamic").factory("dynamicService",["$resource","$log","ceConfig",function(e,t,n){var o=e(n.apiUrl+"/demo/:demoId",{demoId:"@_id"},{update:{method:"PUT"},query:{method:"GET",isArray:!1}});return o}]),angular.module("todo").run(["Menus",function(e){var t=e.genParentMenus({name:"JASON的基地",icon:"check",isPublic:!1,roles:"JASON"}),n=e.genNodeMenus({name:"TODO",icon:"tasks",route:"todo",isPublic:!0}),o=e.genNodeMenus({name:"GitHub Search",icon:"search",route:"search"}),a=e.genNodeMenus({name:"计时器",icon:"time",route:"timer"}),r=e.genNodeMenus({name:"精要指令",icon:"king",route:"directiveKing"}),i=e.genNodeMenus({name:"文件上传",icon:"file",route:"fileUpload"}),s=e.genNodeMenus({name:"用户指引",icon:"file",route:"training"});t.setOrder(99),t.addNodeMenus(n),t.addNodeMenus(o),t.addNodeMenus(a),t.addNodeMenus(r),t.addNodeMenus(i),t.addNodeMenus(s),e.addMenus(t.getMenus())}]).config(["$stateProvider","$translatePartialLoaderProvider",function(e,t){t.addPart("todo"),e.state("todo",{url:"/todo",templateUrl:"modules/todo/views/todo.view.html",controller:"todoCtrl"}).state("search",{url:"/search",templateUrl:"modules/todo/views/todo.search.view.html",controller:"searchCtrl"}).state("timer",{url:"/timer",templateUrl:"modules/todo/views/todo.timer.view.html",controller:"timerCtrl"}).state("directiveKing",{url:"/directiveKing",templateUrl:"modules/todo/views/todo.directive.king.view.html",controller:"directiveKingCtrl"}).state("fileUpload",{url:"/fileUpload",templateUrl:"modules/todo/views/todo.fileUpload.view.html",controller:"fileUploadCtrl"}).state("training",{url:"/training",templateUrl:"modules/todo/views/todo.training.view.html",controller:"trainingCtrl"})}]),angular.module("todo").controller("todoCtrl",["$scope","$sce","$uibModal","$log","uibDatepickerPopupConfig","TodoService","TodoCustomService","FileUploadService","Upload",function(e,t,n,o,a,r,i,s,l){window.marked.setOptions({renderer:new window.marked.Renderer,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,highlight:function(e){return window.prettyPrintOne(e,"HTML",!0)}}),e.previewed=!1,
e.previewedContent="",e.togglePreview=function(n){return e.previewed=!e.previewed,angular.isUndefined(n)?void(e.previewedContent=""):void(e.previewed===!0&&(e.previewedContent=t.trustAsHtml(window.marked(n))))},e.upload=function(e,t){for(var n in e){var o=e[n];console.log("Jason file",o),s.upload(o,t)}},e.opened=[],a.currentText="今天",a.clearText="清空",a.closeText="确定",e.dynamicPopover={templateUrl:"myPopoverTemplate.html",memberTemplateUrl:"memberTemplate.html"},e.task=i.createTask(),e.addTask=function(t,n){if(n&&n.preventDefault(),e.form.$valid){var o=i.addTask(e.task);o&&(e.task=i.createTask())}},e.cleanTask=function(){e.tasks.length=0},e.taskClass=function(e){return{"task-done":!!e.status}},e.toggleTaskStatus=function(e){i.toggleTaskStatus(e)},e.onEditTask=function(e){console.log("Jason test",e),alert("别紧张,测试而已")},e.$on("tasks.update",function(t){e.$apply(function(){e.tasks=i.tasks})}),e.tasks=i.tasks,e.isCollapsed=!0,e.toggleDetail=function(e,n){console.log("Jason test",e),angular.isUndefined(n.content)||e===!1&&(n.previewedContent=t.trustAsHtml(window.marked(n.content)))}}]),angular.module("todo").controller("directiveKingCtrl",["$scope",function(e){e.testa="test1",e.testb="test2",e.testc="test3",e.testd="test4",e.teste="test5",e.testf="test6",e.testg="test7"}]),angular.module("todo").controller("fileUploadCtrl",["$scope","Upload","uiGridConstants",function(e,t,n){e.file=null,e.files=null,e.demoData=[],e.$watch("file",function(t){console.log("Jason file watch",t),e.progressPercentage=0,t&&e.demoData.push(t)}),e.$watch("files",function(t){if(console.log("Jason files watch",t),e.progressPercentage=0,t)if(angular.isArray(t))for(var n in t)e.demoData.push(t[n]);else e.demoData.push(t)}),e.gridOptions={data:"demoData",animate:!1,enableColumnMenus:!1,enableSorting:!1,enableVerticalScrollbar:n.scrollbars.NEVER,rowHeight:40,columnDefs:[{name:"$$hashKey",displayName:"ID"},{name:"name",displayName:"名称"},{name:"size",displayName:"size"},{name:"type",displayName:"type"},{name:"remark",displayName:"备注"},{name:"1",displayName:"Status",cellTemplate:"<span>success</span>"},{name:"2",displayName:"Progress",cellTemplate:' <uib-progressbar animate="true" value="row.entity.progressPercentage || 0" type="success"><b>{{row.entity.progressPercentage || 0}}%</b></uib-progressbar>'},{name:"3",displayName:"preview",cellTemplate:'<div class="text-center"><img src="" ngf-thumbnail="row.entity || \'modules/todo/images/yan.jpg\'" style="width: 40px;height: 40px;"></div>'},{name:"ShowScope",displayName:"Actions",cellTemplate:'<button class="btn btn-sm primary" ng-click="grid.appScope.upload(row.entity)">提交</button>'}]},e.submit=function(){e.progressPercentage=0,console.log("Jason test",e.file),e.upload(e.file)},e.submits=function(){console.log("Jason $scope.files",e.files),e.uploadFiles(e.files)},e.upload=function(n){n&&t.upload({url:"http://localhost:8999/api/fileUpload/uploadImage",data:{file:n,username:e.username}}).then(function(e){console.log("Success "+e.config.data.file.name+"uploaded. Response: "+e.data),n.status="Success"},function(e){console.log("Error status: "+e.status),n.status=e.status},function(t){var o=parseInt(100*t.loaded/t.total);n.progressPercentage=o,e.progressPercentage=o,console.log("progress: "+o+"% "+t.config.data.file.name)})},e.uploadFiles=function(t){if(t&&t.length)for(var n=0;n<t.length;n++)e.upload({data:{file:t[n]}})}}]),angular.module("todo").controller("searchCtrl",["$scope","GitHubService",function(e,t){e.executeSearch=function(){t.searchRepos(e.query,function(t,n){t||(e.repos=n.items)})},e.openRepo=function(n){t.getRepo(n,function(o,a){o||(e.activeRepo=a,t.getReadme(n,function(t,n){t?e.activeRepo.readme="No README found!别折磨自己了好吗..":e.activeRepo.readme=n}))})}}]),angular.module("todo").controller("timerCtrl",["$scope","$interval","$timeout",function(e,t,n){var o;e.execute=function(){o=t(function(){console.log("doing task ... ")},1e3,5),o.then(function(){console.log("Jason test success")},function(){console.log("Jason test error")},function(){console.log("Jason test notify")})},e.cancelTimer=function(){angular.isDefined(o)&&t.cancel(o)},e.format="yyyy-MM-dd h:mm:ss a",e.blood_1=100,e.blood_2=120;var a;e.fight=function(){angular.isDefined(a)||(a=t(function(){console.log("Jason test",12345),e.blood_1>0&&e.blood_2>0?(e.blood_1=e.blood_1-3,e.blood_2=e.blood_2-4):e.stopFight()},100))},e.stopFight=function(){angular.isDefined(a)&&(t.cancel(a),a=void 0)},e.resetFight=function(){e.blood_1=100,e.blood_2=120},e.$on("$destroy",function(){e.stopFight(),e.cancelTimer()}),e.testa="test1",e.testb="test2",e.testc="test3",e.testd="test4",e.teste="test5",e.testf="test6",e.testg="test7"}]),angular.module("todo").filter("range",[function(){return function(e){var t=window._.range(1,e+1);return t}}]).controller("StepPanelController",["currentStep","trainnings","trainningInstance",function(e,t,n){console.log("Jason test trainnings",t),console.log("Jason test trainningInstance",n);var o=this;return o.currentStep=e,o.trainnings=t,o.trainningInstance=n,o.texts=["Write your own sort blog.","Click button to public your blog.","View your blog info on there.","Click this button, you can restart this trainning when .","All trainnings done!"],o}]).constant("trainningCourses",{courses:[{title:"Step 1:",templateUrl:"trainning-content.html",controller:"StepPanelController",controllerAs:"stepPanel",placement:"left",backdrop:!0,position:"#blogControl"},{title:"Step 2:",templateUrl:"trainning-content.html",controller:"StepPanelController",controllerAs:"stepPanel",placement:"right",backdrop:!1,position:"#submitBlog"},{title:"Step 3:",templateUrl:"trainning-content.html",controller:"StepPanelController",controllerAs:"stepPanel",placement:"top",position:{top:200,left:100}},{title:"Step 4:",templateUrl:"trainning-content.html",controller:"StepPanelController",controllerAs:"stepPanel",placement:"bottom",position:"#startAgain"},{stepClass:"last-step",backdropClass:"last-backdrop",templateUrl:"trainning-content-done.html",controller:"StepPanelController",controllerAs:"stepPanel",position:["$window","stepPanel","$uibPosition",function(e,t,n){var o=n.position(t);return{top:(e.innerHeight-o.height)/2,left:(e.innerWidth-o.width)/2}}]}]}).controller("trainingCtrl",["trainningService","trainningCourses","modalBackdropService",function(e,t,n){var o=this;o.trainning=function(){e.trainning(t.courses).done(function(){o.isDone=!0})};angular.noop;return o.backdrop=function(){n.backdrop()},o.closeAlert=function(){o.isDone=!1},o}]),angular.module("todo").directive("addTaskButton",["TodoCustomService",function(e){return{restrict:"A",link:function(t,n,o){n.bind("click",function(){e.addTask({title:"Star Wars",members:"George Lucas"}),t.$broadcast("tasks.update")})}}}]),angular.module("todo").directive("ceDateToggle",["$parse",function(e){return{restrict:"A",require:"uibDatepickerPopup",link:function(e,t,n,o){var a=e.$eval(n.ceDateToggle);e.opened[a]=!!e.opened[a];var r=function(o){o.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){e.opened[a]=!e.opened[a]})};t.bind("click",r),e.$on("$destroy",function(){t.unbind("click",r)})}}}]),angular.module("todo").directive("ceFileUpload",[function(){return{scope:{options:"=ceFileUpload"},link:function(e,t){e.$watch("options",function(e){console.log("Jason test ceFileUpload options",e)})}}}]),angular.module("todo").controller("inputDropdownCtrl",["$scope","$element","$attrs","$compile","$parse","$document","$uibPosition","$rootScope","$timeout","uibDropdownService",function(e,t,n,o,a,r,i,s,l,c){var u=this,d=e;this.toggle=function(e){return d.isOpen=arguments.length?!!e:!d.isOpen,d.isOpen};var p=a(n.isOpen);d.$watch(p,function(e){d.isOpen=!!e}),d.$watch("isOpen",function(e){var t=i.position(u.dropdownToggle);if(u.dropdownMenu&&u.dropdownToggle){var n={display:e?"block":"none",marginTop:t.height+"px",width:t.width+"px"};u.dropdownMenu.css(n)}e?c.open(d):c.close(d)}),d.getAutoClose=function(){return n.autoClose||"always"},d.getToggleElement=function(){return u.dropdownToggle},d.getDropdownElement=function(){return u.dropdownMenu},d.isKeynavEnabled=function(){return!1}}]).directive("ceInputDropdown",[function(){return{restrict:"A",controller:"inputDropdownCtrl",link:function(e,t,n,o){}}}]).directive("ceInputDropdownToggle",[function(){return{restrict:"A",require:"^ceInputDropdown",link:function(e,t,n,o){if(o){o.dropdownToggle||(o.dropdownToggle=t);var a=function(a){a.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){o.toggle(!0)})};t.bind("click",a),e.$on("$destroy",function(){t.unbind("click",a)})}}}}]).directive("ceInputDropdownView",[function(){return{restrict:"A",require:"^ceInputDropdown",link:function(e,t,n,o){o&&(o.dropdownMenu||(o.dropdownMenu=t))}}}]),angular.module("todo").directive("ceSelectOnClick",["$window",function(e){return{restrict:"A",link:function(t,n,o){var a=function(){e.getSelection().toString()||this.setSelectionRange(0,this.value.length)};n.bind("click",a),n.on("$destroy",function(){n.unbind("click",a)})}}}]),angular.module("todo").directive("ceEnter",["$parse",function(e){return{compile:function(t,n){var o=e(n.ceEnter);return function(e,t,n){t.on("keydown",function(t){13===t.keyCode&&e.$apply(function(){o(e,{$event:t})})})}}}}]),angular.module("todo").directive("ceListGroup",[function(){return{restrict:"A",link:function(e,t,n){}}}]),angular.module("todo").directive("ceNotClick",["$parse","$document",function(e,t){return{compile:function(n,o){e(o.cgNotClick);return function(e,n,o){var a=!0;e.$watch(o.notClickWhen,function(e){a=!!e});var r=(o.notClickClass,function(e){e.target});t.on("click",r),e.$on("$destroy",function(){t.off("click",r)})}}}}]),angular.module("todo").directive("cePopover",["$compile","$uibPosition",function(e,t){return{restrict:"A",link:function(e,t,n,o){}}}]),angular.module("todo").directive("ceTest",[function(){return{restrict:"A",template:"this is a test: {{testa}} {{typeInfo}}",scope:{testa:"=ceTest",typeInfo:"=type"},link:function(e,t,n){console.log("Jason test attrs",n),e.$watch(n.ceTest,function(e){console.log("Jason test attrs val",e)})}}}]),angular.module("todo").directive("ceTextarea",function(){return{link:function(e,t,n,o){var a=angular.isDefined(n.autoHeight)?n.autoHeight:t[0].scrollHeight;t.height(Number(a));var r=function(){t.height(Math.max(t[0].scrollHeight,a))};t.bind("input",r),t.on("$destroy",function(){t.unbind("input",r)})}}}),angular.module("todo").directive("myCurrentTime",["$interval","dateFilter",function(e,t){return function(n,o,a){function r(){o.text(t(new Date,i))}var i,s;n.$watch(a.myCurrentTime,function(e){i=e,r()}),s=e(r,1e3),o.on("$destroy",function(){e.cancel(s)})}}]),angular.module("todo").directive("uiBackdrop",["$document",function(e){return{restrict:"EA",replace:!0,templateUrl:"modal-backdrop.html",scope:{backdropClass:"=",zIndex:"="}}}]).directive("trainningStep",["$timeout","$http","$templateCache","$compile","$uibPosition","$injector","$window","$q","$controller",function(e,t,n,o,a,r,i,s,l){return{restrict:"EA",replace:!0,templateUrl:"trainning-step.html",scope:{step:"=",trainnings:"=",nextStep:"&",cancel:"&"},link:function(c,u){function d(e,t){return a.positionElements(angular.element(document.querySelector(t)),m,e.currentTrainning.placement,!0)}function p(e,t){var n=angular.isString(t)?d(e,t):t;console.log("Jason test targetPos",n);var o=e.currentTrainning||{};o.top=n.top+"px",o.left=n.left+"px",e.positionStyle=o}function g(t,n,o){if(o){var a=angular.isFunction(o)||angular.isArray(o)?r.invoke(o,null,{trainnings:t.trainnings,step:t.setp,currentTrainning:t.currentTrainning,stepPanel:n}):o;e(function(){p(t,a)})}}function f(e,o){var a=e.currentTrainning,i=function(e){return e.template?s.when(e.template):t.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:n}).then(function(e){return e.data})},c=function(e){var t=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&t.push(s.when(r.invoke(e)))}),t},u=function(e,t,n,o){var a;n=angular.extend({},n||{},e.locals||{});var r=1;return e.controller&&(n.$scope=t,angular.forEach(e.resolve,function(e,t){n[t]=o[r++]}),a=l(e.controller,n),e.controllerAs&&(t[e.controllerAs]=a)),t},d=s.all([i(a)].concat(c(a.resolve||{})));return d.then(function(t){return u(a,e,o,t),t})}var m=document.querySelector(".step-panel");c.$watch("step",function(e){if(e){c.currentTrainning=c.trainnings[c.step-1];var t=c.$new(!1);f(t,{currentStep:c.step,trainnings:c.trainnings,currentTrainning:c.currentTrainning,trainningInstance:{nextStep:c.nextStep,cancel:c.cancel}}).then(function(e){var n=angular.element(document.querySelector(".popover-content"));n.html(""),n.append(o(e[0])(t))}).then(function(){var e=c.currentTrainning.position;g(c,m,e)})}}),angular.element(i).bind("resize",function(){g(c,m,c.currentTrainning.position)}),c.$on("$destroy",function(){angular.element(i).unbind("resize")})}}}]),angular.module("todo").factory("TodoCustomService",["$rootScope",function(e){var t={tasks:[{title:"Magician",members:"Raymond E. Feist"},{title:"The Hobbit",members:"J.R.R Tolkien"}],addTask:function(e){return angular.isUndefined(e.title)||""===e.title?void 0:(t.tasks.unshift(e),e)},createTask:function(){var e={id:null,title:"",members:"Jason",content:"",date:null,status:!1};return e},toggleTaskStatus:function(e){e.status=!e.status}};return t}]),angular.module("todo").factory("FileUploadService",["$http","$log","ceConfig","Upload",function(e,t,n,o){var a={upload:function(e,t){e&&o.upload({url:"http://localhost:8999/api/fileUpload/uploadImage",data:{file:e}}).then(function(n){console.log("Success "+n.config.data.file.name+"uploaded. Response: "+n.data),e.status="Success",t.content+="![图片](http://localhost:8999"+n.data.data.path+")"},function(t){console.log("Error status: "+t.status),e.status=t.status},function(t){var n=parseInt(100*t.loaded/t.total);e.progressPercentage=n,console.log("progress: "+n+"% "+t.config.data.file.name)})}};return a}]),angular.module("todo").factory("GitHubService",["$http","$resource","$log","ceConfig",function(e,t,n,o){var a={searchRepos:function(t,n){e.get("https://api.github.com/search/repositories",{params:{q:t}}).success(function(e){n(null,e)}).error(function(e){n(e)})},getRepo:function(t,n){e.get("https://api.github.com/repos/"+t).success(function(e){n(null,e)}).error(function(e){n(e)})},getReadme:function(t,n){e.get("https://api.github.com/repos/"+t+"/readme").success(function(e){n(null,atob(e.content))}).error(function(e){n(e)})},getUserRepos:function(t,n){e.get("https://api.github.com/users/"+t+"/repos").success(function(e){n(null,e)}).error(function(e){n(e)})}};return a}]),angular.module("todo").factory("TodoService",["$resource","$log","ceConfig",function(e,t,n){var o=e(n.apiUrl+"/demo/:demoId",{demoId:"@_id"},{update:{method:"PUT"},query:{method:"GET",isArray:!1}});return o}]),angular.module("todo").service("modalBackdropService",["$rootScope","$compile","$document",function(e,t,n){var o=this;o.backdrop=function(o,a){var r=angular.element("<ui-backdrop></ui-backdrop>").attr({"backdrop-class":"backdropClass","z-index":"zIndex"}),i=e.$new(!0);return i.backdropClass=o,i.zIndex=a,n.find("body").append(t(r)(i)),function(){r.remove(),i.$destroy()}}}]).service("trainningService",["$compile","$rootScope","$document","$q",function(e,t,n,o){var a=this;a.trainning=function(a){var r=t.$new(!0),i=o.defer(),s=angular.element("<trainning-step></trainning-step>").attr({step:"step",trainnings:"trainnings","next-step":"nextStep($event, step);",cancel:"cancel($event, step)"}),l=function(){r&&(s.remove(),r.$destroy())};return r.cancel=function(e,t){i.reject("cancel")},r.nextStep=function(e,t){return r.step===a.length?(l(),i.resolve("done")):void r.step++},r.trainnings=a,r.step=1,n.find("body").append(e(s)(r)),r.$on("$locationChangeStart",l),{done:function(e){return i.promise.then(e),this},cancel:function(e){return i.promise.then(null,e),this}}}}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function(e,t,n,o){e.authentication=o,e.authentication.user&&n.path("/"),e.signup=function(){t.post("http://localhost:8080/api/open/user/signup",e.credentials).success(function(t){e.authentication.user=t.data,n.path("/")}).error(function(t){e.error=t.message})},e.signin=function(){e.authentication.user&&n.path("/"),n.path("/auth/signin")}}]),angular.module("users").controller("usersListCtrl",["$scope","$log","$translate","$uibModal","$location","path","UserService","ceUtil",function(e,t,n,o,a,r,i,s){e.selectedData=null,e.isSelected=!1,e.onEditClick=function(t){var n=t;if(!n){if(e.isSelected===!1)return void s.toast("请选中一行数据");n=e.selectedData}var a=o.open({animation:!0,templateUrl:"modules/users/views/case.user.edit.view.html",controller:"userEditCtrl",resolve:{user:function(){return n}}});a.result.then(function(){e.onSearch()})},e.onDeletedClick=function(t){var n=t;if(!n){if(e.isSelected===!1)return void s.toast("请选中一行数据");n=e.selectedData}i.deleteUser(n).success(function(){e.onSearch()})},e.onCreateClick=function(){a.path("/user/signup")},e.userData={},e.searchOptions={keyWord:"",page:0,size:10,sort:null},e.gridOptions={enableFullRowSelection:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,selectionRowHeaderWidth:35,multiSelect:!1,gridMenuTitleFilter:n,data:"userData.data.content",paginationPageSizes:[10,20,50],paginationPageSize:10,useExternalPagination:!0,rowHeight:40,animate:!1,columnDefs:[{name:"displayName",displayName:"昵称",allowCellFocus:!0},{name:"username",displayName:"登录名"},{name:"sex",displayName:"性别"},{name:"type1",displayName:"头像"},{name:"email",displayName:"邮箱"},{name:"phone",displayName:"手机"},{name:"enable",displayName:"状态"},{name:"ShowScope",displayName:"Actions",cellTemplate:'<div class="btn-group-sm"><button class="btn btn-info" ng-click="grid.appScope.onDeletedClick(row.entity)">角色</button><button class="btn btn-danger" ng-click="grid.appScope.onDeletedClick(row.entity)">禁用</button></div>'}],paginationTemplate:s.getPaginationTemplate(),onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.isSelected=t.isSelected,e.selectedData=t.entity}),t.pagination.on.paginationChanged(e,function(t,n){e.searchOptions.page=t-1,e.searchOptions.size=n,e.onSearch()})}},e.onSearch=function(){i.getUsers(e.searchOptions).success(function(t){e.userData=t,e.gridOptions.totalItems=t.data.totalElements})},e.onSearch()}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function(e,t,n,o,a){e.authentication=a,e.authentication.user&&o.path("/"),e.askForPasswordReset=function(){e.success=e.error=null,n.post("/auth/forgot",e.credentials).success(function(t){e.credentials=null,e.success=t.message}).error(function(t){e.credentials=null,e.error=t.message})},e.resetUserPassword=function(){e.success=e.error=null,n.post("/auth/reset/"+t.token,e.passwordDetails).success(function(t){e.passwordDetails=null,a.user=t,o.path("/password/reset/success")}).error(function(t){e.error=t.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$window","$location","UserService","Authentication",function(e,t,n,o,a,r){e.user=r.user,e.user||o.path("/"),e.hasConnectedAdditionalSocialAccounts=function(t){for(var n in e.user.additionalProvidersData)return!0;return!1},e.isConnectedSocialAccount=function(t){return e.user.provider===t||e.user.additionalProvidersData&&e.user.additionalProvidersData[t]},e.removeUserSocialAccount=function(n){e.success=e.error=null,t["delete"]("/users/accounts",{params:{provider:n}}).success(function(t){e.success=!0,e.user=r.user=t}).error(function(t){e.error=t.message})},e.updateUserProfile=function(n){if(n){e.success=e.error=null;var o=e.user;delete o.roles,delete o.authorities,t.put("/users",o).success(function(t){e.success=!0,e.user=r.user=t}).error(function(t){e.error=t.message})}else e.submitted=!0},e.changeUserPassword=function(){e.success=e.error=null,t.post("/users/password",e.passwordDetails).success(function(t){e.success=!0,e.passwordDetails=null}).error(function(t){e.error=t.message})}}]),angular.module("users").run(["Menus",function(e){var t=e.genParentMenus({name:"用户管理",icon:"user"}),n=e.genNodeMenus({name:"当前用户",icon:"ice-lolly-tasted",route:"profile"}),o=e.genNodeMenus({name:"所有用户",icon:"ice-lolly-tasted",route:"users"});t.setOrder(1),t.addNodeMenus(n),t.addNodeMenus(o),e.addMenus(t.getMenus())}]).config(["$httpProvider","$stateProvider",function(e,t){t.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/users.profile.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/users.change-password.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/user/signup",templateUrl:"modules/users/views/authentication/users.signup.view.html"}).state("signin",{url:"/user/signin",templateUrl:"modules/users/views/authentication/users.signin.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/users.forgot-password.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/users.reset-password-invalid.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/users.reset-password-success.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/users.reset-password.view.html"}).state("users",{url:"/users",templateUrl:"modules/users/views/users.list.view.html"}),e.interceptors.push(["$q","$location","Authentication",function(e,t,n){return{responseError:function(o){switch(console.log("rejection.status",o.status),o.status){case 401:n.user=null,t.path("signin");break;case 403:}return e.reject(o)}}}])}]),angular.module("users").factory("Authentication",["$window",function(e){var t=e.user||null,n={user:t};return console.log("login user",n),n}]),angular.module("users").factory("Users",["$resource",function(e){return e("users",{},{update:{method:"PUT"}})}]),angular.module("users").factory("UserService",["$log","ceAjax",function(e,t){var n={};return n.getUsers=function(e){return t.get({url:"/user",data:e})},n.save=function(e){return t.post({url:"/user",data:e})},n}]);