<beans:beans xmlns="http://www.springframework.org/schema/security"
xmlns:beans="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
		   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		   http://www.springframework.org/schema/security
		   http://www.springframework.org/schema/security/spring-security.xsd">
		   
		<!-- <http pattern="/admin/login*" security="none"/>  -->
		
		
		<http  use-expressions="false" auto-config="false"  entry-point-ref="ceAuthenticationEntryPoint" >
			<intercept-url pattern="/admin*" access="ROLE_ADMIN,ROLE_USER" />
			<intercept-url pattern="/*" access="IS_AUTHENTICATED_ANONYMOUSLY"/> 
			<intercept-url pattern="/api/**" access="IS_AUTHENTICATED_ANONYMOUSLY" />
			<intercept-url pattern="/admin/login*" access="IS_AUTHENTICATED_ANONYMOUSLY"/> 
			<custom-filter position="FORM_LOGIN_FILTER" ref="ajaxLoginFilter"/> 
			<custom-filter before="LOGOUT_FILTER" ref="customLogoutFilter" /> 
			<custom-filter  position="REMEMBER_ME_FILTER" ref="rememberMeFilter" />
			<csrf request-matcher-ref="csrfSecurityRequestMatcher"/>
		</http>
		
		
		
		<beans:bean id="sessionRegistry" class="org.springframework.security.core.session.SessionRegistryImpl" />
		
		 <beans:bean id="rememberMeFilter" class="org.springframework.security.web.authentication.rememberme.RememberMeAuthenticationFilter">
			<beans:constructor-arg name="rememberMeServices" ref="rememberMeServices"/>
			<beans:constructor-arg name="authenticationManager" ref="authenticationManager" />
			<beans:property name="authenticationSuccessHandler" ref="ceAuthenticationSuccessHandler"/>
		</beans:bean>
		
		<beans:bean id="ceAuthenticationSuccessHandler" class="com.codingera.common.security.handler.CEUrlAuthenticationSuccessHandler" />
		 
		 <beans:bean id="rememberMeServices" class="org.springframework.security.web.authentication.rememberme.TokenBasedRememberMeServices">
			<beans:constructor-arg name="key" value="ce"/>
			<beans:constructor-arg name="userDetailsService" ref="ceSecurityUserService"/>
			<beans:property name="parameter" value="ce-remember-me"/>
			<beans:property name="cookieName" value="ce-fucking-me"/>
			<beans:property name="alwaysRemember" value="true"/>
		</beans:bean>
		
		
		<beans:bean id="rememberMeAuthenticationProvider" class="org.springframework.security.authentication.RememberMeAuthenticationProvider">
			<beans:constructor-arg name="key" value="gaykes"/>
		</beans:bean>  
		
		
		<!-- <beans:bean id="rememberMeServices"  class="org.springframework.security.web.authentication.rememberme.TokenBasedRememberMeServices">  
		    <beans:property name="key" value="gaykes"/>  
		    <beans:property name="alwaysRemember" value="true"/> 
		    <beans:property name="parameter" value="rememberMe"/>  
		    <beans:property name="tokenValiditySeconds" value="604800"/>  
		    <beans:property name="userDetailsService" ref="geekUserService"/>  
		</beans:bean>  -->
		
		
		<beans:bean id="ajaxLoginFilter"     class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">  
               <beans:property name="authenticationManager" ref="authenticationManager"/>  
               <beans:property name="authenticationFailureHandler" ref="ajaxFailureHandler"/>  
               <beans:property name="authenticationSuccessHandler" ref="ajaxSuccessHandler"/>  
               <beans:property name="filterProcessesUrl" value="/admin/ajaxLoginProcess"/> 
          </beans:bean>  
          
          <beans:bean id="customLogoutFilter" class="com.codingera.common.security.filter.CustomLogoutFilter">
	         <!-- 处理退出的虚拟url -->
	         <beans:property name="filterProcessesUrl" value="/logout" />
	         <!-- 退出处理成功后的默认显示url -->
	         <beans:constructor-arg index="0" value="/" />
	         <beans:constructor-arg index="1">
	             <!-- 退出成功后的handler列表 -->
	             <beans:array>
	                 <beans:bean id="securityContextLogoutHandler"
	                     class="org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler" />
	                 <!-- 加入了开发人员自定义的退出成功处理 -->
	                 <beans:bean id="customLogoutSuccessHandler" class="com.codingera.common.security.handler.CustomLogoutHandler" />
	             </beans:array>
	         </beans:constructor-arg>
	     </beans:bean>
          
         <beans:bean id="ajaxFailureHandler" class="com.codingera.common.security.handler.AjaxAuthenticationFailureHandler">  
         </beans:bean>  

         <beans:bean id="ajaxSuccessHandler" class="com.codingera.common.security.handler.AjaxAuthenticationSuccessHandler">  
         </beans:bean> 
         
         <beans:bean id="ceAuthenticationEntryPoint" class="com.codingera.common.security.CEAuthenticationEntryPoint">  
	        <beans:constructor-arg name="loginFormUrl" value="/admin/login" />  
	    </beans:bean>
	    
	    <!-- <beans:bean id="userService" class="com.codingera.module.user.service.UserService">
		</beans:bean> -->
	    
	    <beans:bean id="ceSecurityUserService" class="com.codingera.module.user.service.CESecurityUserService" >
	    		
	    </beans:bean>
	    
	    <beans:bean id="csrfSecurityRequestMatcher" class="com.codingera.common.security.CsrfSecurityRequestMatcher">
          	<beans:property name="execludeUrls">
	            <beans:list>
	                 <beans:value>/api/</beans:value>
	             </beans:list>
         	</beans:property>
    	</beans:bean>
	    
		<beans:bean id="passwordEncoder" class="org.springframework.security.authentication.encoding.Md5PasswordEncoder" />  
		<authentication-manager alias="authenticationManager">
			<authentication-provider user-service-ref="ceSecurityUserService" >
			<password-encoder ref="passwordEncoder" />
			</authentication-provider>
			<authentication-provider ref="rememberMeAuthenticationProvider" />
			
			<!-- <authentication-provider>
				<user-service>
				  <user name="jimi" password="jimispassword" authorities="ROLE_USER, ROLE_ADMIN" />
				  <user name="bob" password="bobspassword" authorities="ROLE_USER" />
				  <user name="admin" password="admin" authorities="ROLE_USER" />
				</user-service>
			</authentication-provider> -->
		</authentication-manager>
</beans:beans> 



    
    